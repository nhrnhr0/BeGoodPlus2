{% extends "newBase.html" %}

{% load i18n %}
{% load static %}
{% load bootstrap5 %}

{% block head_title %}{% trans "Main" %}{% endblock %}
{% block extra_head %}
<!-- css includes in head -->
<link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/kenwheeler/slick@1.8.1/slick/slick.css" />
<!-- Add the slick-theme.css if you want default styling -->
<link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/kenwheeler/slick@1.8.1/slick/slick-theme.css" />

<link rel="stylesheet" href="{%static 'assets/catalog/css/style.css' %}">
{% endblock extra_head%}

{% block content %}
<div class="catalog">
    <!--
    {%for album in  catalogAlbums %}
    {%if album.is_public %}
    <div class="title">{{album}}</div>
    <div class="container">
        <div id="slick-slider-{{forloop.counter0}}" class="slick-slider">
            {%for img in album.images.all  %}
            <div class="my-slick-slide shadow-lg"><img data-lazy="{{img.image_thumbnail.url}}" alt="" /></div>
            {%endfor%}
        </div>
    </div>
    {%endif%}
    {%endfor%}
    -->
</div>

<div class="modal" id="catalogModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Modal title</h5>
                <button type="button" class="close" data-dismiss="catalogModal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Modal body text goes here.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary">Save changes</button>
                <button type="button" class="btn btn-secondary" data-dismiss="catalogModal">Close</button>
            </div>
        </div>
    </div>
</div>
{%endblock%}

{%block extra_body%}
<script type="text/javascript" src="//cdn.jsdelivr.net/gh/kenwheeler/slick@1.8.1/slick/slick.min.js"></script>


<script type="text/javascript">
    $(document).ready(function () {
        albums = getAllAlbums();
        var catalogMarkup = ``;
        for(var i = 0; i<albums.length; i++) {
            var albumMarkup = ``;
            album = albums[i];
            if(albums[i].is_public) {
                albumMarkup += `
                    <div class="title">${album.title}</div>
                    <div class="container">
                        <div id="slick-slider-${i}" class="slick-slider">`
                for(var j = 0; j < album.images_list.length;j++) {
                    var img = album.images_list[j];
                    albumMarkup += `<div data-prod-title="${img.title}" data-prod-image-thumbnail="${img.image_thumbnail}" data-prod-id="${img.id}" data-prod-description="${img.description}" class="my-slick-slide shadow-lg"><img data-lazy="${img.image_thumbnail}" alt="" /></div>`
                }
                albumMarkup += `</div></div>`
            }
            catalogMarkup += albumMarkup;
        }
        $('.catalog').html(catalogMarkup);
        console.log(albums)
        var slisks = $('.slick-slider');
        for (var i = 0; i < slisks.length; i++) {


            var numberOfItems = $(slisks[i]).find('.my-slick-slide').length
            var isDots = true;
            if (numberOfItems > 20) {
                isDots = false;
            }
            $(slisks[i]).slick({
                slidesToShow: 5,
                slidesToScroll: 1,
                dots: isDots,
                focusOnSelect: true,
                rtl: true,
                swipeToSlide: true,
                lazyLoad: 'ondemand',



                responsive: [{
                    breakpoint: 500,
                    settings: {
                        slidesToShow: 3,
                    }
                }]
            });

        }

        $('.my-slick-slide').on('click',(e)=>{
            console.log(e.currentTarget);
            $('#catalogModal').data('prod-id', e.currentTarget.dataset.prodId);
            $('#catalogModal').modal('show');
            $('#catalogModal .modal-title').text(e.currentTarget.dataset.prodTitle);
            $('#catalogModal .modal-body').html(`
                <div class="inner-body">
                    <div class="img-wraper"><img src="${e.currentTarget.dataset.prodImageThumbnail}"/></div>
                    <div class="product-detail">${e.currentTarget.dataset.prodDescription}</div>
                    
                </div>
            `)
        });


    });
</script>
{%endblock%}